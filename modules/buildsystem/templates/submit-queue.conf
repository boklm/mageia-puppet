<% 
escaped_domain = domain.gsub('.','\.')
%>

home: <%= sched_home_dir %>

# repository declaration
repository:
    class: Youri::Repository::Mageia_upload
    options:
        install_root: <%= repository_root %>/distrib
        upload_root: ${home}/uploads/
        upload_state: queue
        queue: queue
        noarch: i586
        svn: svn+ssh://svn.<%= domain %>/svn/packages/cauldron/
        1.0:
            arch: i586 x86_64
        cauldron:
            arch: i586 x86_64

# targets definition
targets:
    cauldron:
        checks:
            - version
            - tag
            - acl
            - rpmlint
            - recency
            - queue_recency
        actions:
#            - sign
            - install
            - link
#            - mail
#            - archive
            - clean

    1.0:
        checks:
            - version
            - tag
            - acl
            - rpmlint
            - recency
            - queue_recency
        actions:
#            - sign
            - install
            - link
#            - mail
#            - archive
            - clean

# checks definition
checks:
    tag:
        class: Youri::Submit::Check::Tag
        options:
            tags:
                release: 'mga\d+'
              #  packager: '<\S+@<%= escaped_domain %>>$'
                distribution: '^Mageia'
                vendor: '^Mageia.org$'

    recency:
        class: Youri::Submit::Check::Recency

    queue_recency:
        class: Youri::Submit::Check::Queue_recency

    host:
        class: Youri::Submit::Check::Host
        options:
                   host_file:  /etc/youri/host.conf

    section:
        class: Youri::Submit::Check::Section

    rpmlint:
        class: Youri::Submit::Check::Rpmlint
        options:
            config: /etc/rpmlint/config
            results:
                - buildprereq-use
                - no-description-tag
                - no-summary-tag
                - non-standard-group
                - non-xdg-migrated-menu
                # it breaks dbus
                #- patch-not-applied
                - percent-in-conflicts
                - percent-in-dependency
                - percent-in-obsoletes
                - percent-in-provides
                - summary-ended-with-dot

    svn:
        class: Youri::Submit::Check::SVN

    acl:
        class: Youri::Submit::Check::ACL
        options:
            acl_file: /etc/youri/acl.conf

    history:
        class: Youri::Submit::Check::History

    source:
        class: Youri::Submit::Check::Source

    precedence:
        class: Youri::Submit::Check::Precedence
        options:        
            target: cauldron

    version:
        class: Youri::Submit::Check::Version
        options:
           1.0:
               authorized_packages: none_package_authorized
               authorized_sections: ^[a-z]+/(updates|testing|backports|backports_testing)$
               authorized_arches: none
               mode: freeze

           cauldron:
# <mrl> Prior freeze
               authorized_sections: ^[a-z]+/(release|testing)$
               authorized_arches: .*
               mode: normal
## <blino> Version freeze
#               authorized_packages: ^$
#               authorized_sections: ^main/testing|contrib/testing$
#               authorized_arches: ^$
#               authorized_users: ^blino|ennael|nvigier$
#               mode: version_freeze
# <mrl> Freeze config
#               authorized_packages: ^mdkonline|drakxtools|urpmi|ia_ora-gnome|ldetect|ldetect-lst|rpm-mageia-setup|perl-MDK-Common$
#               authorized_packages: none_package_authorized
#               authorized_sections: ^restricted/release|main/testing|contrib/testing$
#               authorized_arches: none
#               authorized_users: ^blino|ennael|nvigier$
#               mode: freeze

# actions definitions
actions:
    install:
        class: Youri::Submit::Action::Install

    markrelease:
	class: Youri::Upload::Action::Markrelease

    link:
	class: Youri::Upload::Action::Link

    archive:
	class: Youri::Upload::Action::Archive

    clean:
	class: Youri::Upload::Action::Clean

# vim:ft=yaml:et:sw=4
