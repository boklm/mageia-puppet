<% 
escaped_domain = domain.gsub('.','\.')
%>

home: <%= sched_home_dir %>

# repository declaration
repository:
    class: Youri::Repository::Mageia
    options:
        install_root: <%= repository_root %>/distrib
        upload_root: ${home}/uploads/
        upload_state: todo done queue
        queue: todo
        noarch: i586
        svn: svn+ssh://svn.<%= domain %>/svn/packages/cauldron/
        1:
            arch: i586 x86_64
        cauldron:
            arch: i586 x86_64

# targets definition
targets:
    cauldron:
        checks:
            - source
            - deps
            - version
            #- svn
            - tag
            - acl
            - host
            - section
            - rpmlint
            - recency
            #- history
            - queue_recency
        actions:
            - send
            - rpminfo

    1:
        checks:
            - source
            - version
            #- svn
            - tag
            - acl
            - host
            - section
            - rpmlint
            - recency
            #- history
            - queue_recency
        actions:
            - send
            - rpminfo

# checks definition
checks:
    tag:
        class: Youri::Submit::Check::Tag
        options:
            tags:
                release: 'mga\d+'
              #  packager: '<\S+@<%= escaped_domain %>>$'
                distribution: '^Mageia'
                vendor: '^Mageia.Org$'

    recency:
        class: Youri::Submit::Check::Recency

    queue_recency:
        class: Youri::Submit::Check::Queue_recency

    host:
        class: Youri::Submit::Check::Host
        options:
                   host_file:  /etc/youri/host.conf

    section:
        class: Youri::Submit::Check::Section

    rpmlint:
        class: Youri::Submit::Check::Rpmlint
        options:
            config: /etc/rpmlint/config
            results:
                - buildprereq-use
                - no-description-tag
                - no-summary-tag
                - non-standard-group
                - non-xdg-migrated-menu
                # it breaks dbus
                #- patch-not-applied
                - percent-in-conflicts
                - percent-in-dependency
                - percent-in-obsoletes
                - percent-in-provides
                - summary-ended-with-dot

    svn:
        class: Youri::Submit::Check::SVN

    acl:
        class: Youri::Submit::Check::ACL
        options:
            acl_file: /etc/youri/acl.conf

    history:
        class: Youri::Submit::Check::History

    source:
        class: Youri::Submit::Check::Source

    precedence:
        class: Youri::Submit::Check::Precedence
        options:        
            target: cauldron

    version:
        class: Youri::Submit::Check::Version
        options:
           1.0:
               authorized_packages: none_package_authorized
               authorized_sections: ^(core|nonfree|tainted)/(updates|updates_testing|backports|backports_testing)$
               authorized_arches: none
               mode: freeze

           cauldron:
# * No freeze
#               authorized_sections: ^[a-z]+/(release|updates_testing)$
#               authorized_arches: .*
#               mode: normal
# * Version freeze
               authorized_packages: ^$
               authorized_sections: ^(core|nonfree|tainted)/updates_testing$
               authorized_arches: ^$
               authorized_users: ^blino|ennael|misc|boklm|pterjan|stewb|tmb|saispo$
               mode: version_freeze
# * Full freeze
#               authorized_packages: ^mdkonline|drakxtools|urpmi|ia_ora-gnome|ldetect|ldetect-lst|rpm-mageia-setup|perl-MDK-Common$
#               authorized_packages: none_package_authorized
#               authorized_sections: ^restricted/release|main/updates_testing|contrib/updates_testing$
#               authorized_arches: none
#               authorized_users: ^blino|ennael|misc|boklm|pterjan|stewb|tmb$
#               mode: freeze

    deps:
        class: Youri::Submit::Check::Deps

# actions definitions
actions:
    send:
        class: Youri::Submit::Action::Send
        options:
            user: <%= sched_login %>
            keep_svn_release: yes
            uphost: pkgsubmit.<%= domain %>
            root: ${home}/uploads
            ssh_key: ${home}/.ssh/id_rsa

    rpminfo:
        class: Youri::Submit::Action::Rpminfo
        options:
            user:  <%= sched_login %>
            uphost: pkgsubmit.<%= domain %>
            root: ${home}/uploads
            ssh_key: ${home}/.ssh/id_rsa

# vim:ft=yaml:et:sw=4
